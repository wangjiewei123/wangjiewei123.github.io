<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>JumpServer堡垒机使用 | 人在塔在</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config = {"root":"/","path":""}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg);"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/demo/"><span class="navItemTitle">独立页面</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>JumpServer堡垒机使用</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2022-11-14T01:21:15.000Z" id="date"> 2022-11-14</time></div></span><br><span>Last Update: <div class="control"><time datetime="2022-11-17T00:35:47.204Z" id="updated"> 2022-11-17</time></div></span></div></div><hr><div id="post-content"><h3 id="什么是堡垒机"><a href="#什么是堡垒机" class="headerlink" title="什么是堡垒机"></a>什么是堡垒机</h3><p>堡垒机也是一台服务器，在一个特定的网络环境下，为了保障网络和数据不受来自外部和内部用户的入侵和破坏，而运用各种技术手段实时收集、监控网络环境中每一个组成部分（服务器）的系统状态、安全事件、网络活动，以便集中报警、及时处理以及审计定责<br>可以把堡垒机看作一个升级版的跳板机，跳板机有的功能堡垒机都有并且还多了许多功能，如实时收集、监控网络环境、集中报警等功能<br>堡垒机的优点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">堡垒机可以给其他服务器推送sudo用户，并且为其设置权限</span><br><span class="line">堡垒机多了一个用户行为监控的功能，并且是录像</span><br></pre></td></tr></table></figure>

<h3 id="JumpServer概述"><a href="#JumpServer概述" class="headerlink" title="JumpServer概述"></a>JumpServer概述</h3><p>JumpServer是全球首款完全开源的堡垒机，使用GNU GPL v2.0开源协议，是符合4A的专业运维审计系统<br>JumpServer使用Python\Django开发，遵循Web 2.0规范，配备了业界领先的web Terminal（web终端，即网页终端）解决方案，交互界面美观，用户体验良好<br>JumpServer采用分布式结构，支持多机房跨区域部署，中心节点提供API（接口），各机房部署登录节点，可以横向扩展，并且没有并发限制<br>JumpServer为互联网企业提供了认证、授权、审计、自动化运维等功能<br>JumpServer通过调用各种应用程序的模块来实现各种功能</p>
<h2 id="JumpServer实现的功能"><a href="#JumpServer实现的功能" class="headerlink" title="JumpServer实现的功能"></a>JumpServer实现的功能</h2><p><img src="/2022/11/14/2022-11-14/2.jpg"></p>
<hr>
<h4 id="身份验证Authentication"><a href="#身份验证Authentication" class="headerlink" title="身份验证Authentication"></a>身份验证Authentication</h4><p>登录认证：资源统一登录和认证、LDAP认证、支持OpenID，实现单点登录<br>多因子认证：MFA（Google Authenticator）</p>
<h4 id="账号管理-Account"><a href="#账号管理-Account" class="headerlink" title="账号管理 Account"></a>账号管理 Account</h4><p>集中账号管理：管理用户管理、系统用户管理<br>统一密码管理：资产密码托管、自动生成密码、密码自动推送、密码过期设置<br>批量密码变更：定期批量修改密码、生成随机密码<br>多云环境的资产纳管：对私有云、公有云资产统一管理</p>
<h4 id="授权控制Authorization"><a href="#授权控制Authorization" class="headerlink" title="授权控制Authorization"></a>授权控制Authorization</h4><p>资产授权管理：资产树、资产或资产组灵活授权、节点内资产自动继承授权<br>RemoteApp：实现更细粒度的应用级授权<br>组织管理：实现多租户管理，权限隔离<br>多维度授权：可以对用户、用户组或者系统角色授权<br>指令限制：限制特权指令使用、支持黑白名单<br>统一文件传输：SFTP文件的上传\下载<br>文件管理：Web SFTP文件管理</p>
<h4 id="安全审计Audit"><a href="#安全审计Audit" class="headerlink" title="安全审计Audit"></a>安全审计Audit</h4><p>会话管理：在线会话管理、历史会话管理<br>录像管理：linux录像支持、windows录像支持<br>指令审计：指令记录<br>文件传输审计：上传\下载记录审计</p>
<h4 id="部署JumpServer堡垒机"><a href="#部署JumpServer堡垒机" class="headerlink" title="部署JumpServer堡垒机"></a>部署JumpServer堡垒机</h4><p><img src="/2022/11/14/2022-11-14/4.jpg"></p>
<p>（1）实验环境<br>JumpServer对硬件和软件是有要求的<br>硬件要求：2个CPU核心，4G内存，50G硬盘，这是最低配置<br>操作系统：Linux发行版 X86_64位的系统<br>Python：只可以使用Python3.6.X版本<br>Mysql：大于等于5.6版本<br>mariadb：大于等于5.5.56版本<br>redis<br>系统	ip地址	Python版本	主机名<br>Centos7.4	192.168.100.202 桥接网卡 （两块网卡）	python3.6.8	jumpserver</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line">******（1）先做基础配置</span><br><span class="line">[root@Centos7 ~]# hostnamectl set-hostname jumpserver</span><br><span class="line">[root@Centos7 ~]# su</span><br><span class="line">[root@jumpserver ~]# systemctl stop firewalld</span><br><span class="line">[root@jumpserver ~]# setenforce 0</span><br><span class="line">setenforce: SELinux is disabled</span><br><span class="line">[root@jumpserver ~]# mount /dev/cdrom /mnt/</span><br><span class="line">mount: /dev/sr0 写保护，将以只读方式挂载</span><br><span class="line">mount: /dev/sr0 已经挂载或 /mnt 忙</span><br><span class="line">       /dev/sr0 已经挂载到 /mnt 上</span><br><span class="line">[root@jumpserver ~]# vim /etc/yum.repos.d/centos.repo #修改yum源，修改为本地yum源，也可以使用网络yum源进行下载，依赖包很多</span><br><span class="line">[aaa]</span><br><span class="line">name=aaa</span><br><span class="line">baseurl=file:///mnt</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[jumpserver]</span><br><span class="line">name=jumpserver</span><br><span class="line">baseurl=file:///root/jumpserver-packs</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">[root@jumpserver ~]# ll       #上传yum库</span><br><span class="line">总用量 92708</span><br><span class="line">-rw-------. 1 root root     1264 1月  12 18:27 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--  1 root root 94928169 5月  31 18:48 jumpserver-packs.tar.gz</span><br><span class="line">[root@jumpserver ~]# tar xf jumpserver-packs.tar.gz  </span><br><span class="line">[root@jumpserver ~]# ll</span><br><span class="line">总用量 92720</span><br><span class="line">-rw-------. 1 root root     1264 1月  12 18:27 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x  3 root root     8192 12月 10 2019 jumpserver-packs</span><br><span class="line">-rw-r--r--  1 root root 94928169 5月  31 18:48 jumpserver-packs.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******（2）上传安装包，进行安装</span><br><span class="line">[root@jumpserver ~]# ll</span><br><span class="line">总用量 181496</span><br><span class="line">-rw-------. 1 root root     1264 1月  12 18:27 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--  1 root root  7664345 5月  31 18:51 jumpserver-master.zip</span><br><span class="line">drwxr-xr-x  3 root root     8192 12月 10 2019 jumpserver-packs</span><br><span class="line">-rw-r--r--  1 root root 94928169 5月  31 18:48 jumpserver-packs.tar.gz</span><br><span class="line">-rw-r--r--  1 root root 60226671 5月  31 18:51 pip-packs.tar.gz</span><br><span class="line">-rw-r--r--  1 root root 23010188 5月  31 18:52 Python-3.6.8.tgz</span><br><span class="line">[root@jumpserver ~]# tar xf pip-packs.tar.gz </span><br><span class="line">[root@jumpserver ~]# tar xf Python-3.6.8.tgz -C /usr/local/src/</span><br><span class="line">[root@jumpserver ~]# yum install -y gcc zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel libffi-devel #安装依赖包</span><br><span class="line">。。。。。。</span><br><span class="line">完毕！</span><br><span class="line">[root@jumpserver ~]# cd /usr/local/src/Python-3.6.8/</span><br><span class="line">[root@jumpserver Python-3.6.8]#  ./configure --prefix=/usr/local/python &amp;&amp; make -j 2 &amp;&amp; make install  #make -j 2表示使用两个cpu进行编译</span><br><span class="line">[root@jumpserver Python-3.6.8]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@jumpserver Python-3.6.8]# ln -s /usr/local/python/bin/* /usr/local/bin/ #优化python命令执行路径</span><br><span class="line">[root@jumpserver Python-3.6.8]# python3 -V #查看python版本</span><br><span class="line">Python 3.6.8</span><br><span class="line">[root@jumpserver Python-3.6.8]# pip3 -V #查看pip版本</span><br><span class="line">pip 18.1 from /usr/local/python/lib/python3.6/site-packages/pip (python 3.6)</span><br><span class="line">[root@jumpserver Python-3.6.8]# cd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******（3）配置python3虚拟环境，因为centos6、7自带的python版本是python2，而yum等工具依赖的是python2，所以不能直接把python2换成python3，为了不扰乱原来的环境，可以配置python3的虚拟环境，进入虚拟环境后所有的操作都会在虚拟环境中执行</span><br><span class="line">[root@jumpserver ~]# python3.6 -m venv /opt/py3 #创建虚拟环境</span><br><span class="line">[root@jumpserver ~]# source /opt/py3/bin/activate #进入虚拟环境</span><br><span class="line">(py3) [root@jumpserver ~]#   #前面多了（py3）就是进入了虚拟环境</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******（4）安装jumpserver</span><br><span class="line">(py3) [root@jumpserver ~]# yum -y install unzip </span><br><span class="line">。。。。。。</span><br><span class="line">完毕！</span><br><span class="line">(py3) [root@jumpserver ~]# unzip jumpserver-master.zip -d /opt/ #解压</span><br><span class="line">(py3) [root@jumpserver ~]# cd /opt/</span><br><span class="line">(py3) [root@jumpserver opt]# mv jumpserver-master/ jumpserver #重命名</span><br><span class="line">(py3) [root@jumpserver opt]# cd /opt/jumpserver/requirements/</span><br><span class="line">(py3) [root@jumpserver requirements]# ll</span><br><span class="line">总用量 24</span><br><span class="line">-rw-r--r-- 1 root root  251 7月  26 2019 alpine_requirements.txt</span><br><span class="line">-rw-r--r-- 1 root root  212 7月  26 2019 deb_requirements.txt</span><br><span class="line">-rw-r--r-- 1 root root  359 7月  26 2019 issues.txt</span><br><span class="line">-rw-r--r-- 1 root root   54 7月  26 2019 mac_requirements.txt</span><br><span class="line">-rw-r--r-- 1 root root 1551 7月  26 2019 requirements.txt</span><br><span class="line">-rw-r--r-- 1 root root  204 7月  26 2019 rpm_requirements.txt</span><br><span class="line">(py3) [root@jumpserver requirements]#  yum -y install $(cat rpm_requirements.txt)     #rpm_requirements.txt里面就是jumpserver所需要的所有rpm包，$(cat rpm_requirements.txt)可以直接全部安装</span><br><span class="line">。。。。。。</span><br><span class="line">完毕！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******（5）安装python库依赖</span><br><span class="line">#安装python库依赖有两种方法，一种是没有网络的环境下安装，一种是有网络的环境下安装</span><br><span class="line">#没有网络的环境下安装：（需要有现成的pip包，一开始已经上传了）</span><br><span class="line">(py3) [root@jumpserver requirements]# pip install --no-index --find-links=/root/pip-packs/ pyasn1 six cffi pytest-runner #需要先安装这几个依赖包，--no-index是忽略包索引，不加这个的话会上网络上寻找，--find-links=为指定依赖包的路径，表示直接从这个路径下寻找</span><br><span class="line">。。。。。。</span><br><span class="line">完毕！</span><br><span class="line">(py3) [root@jumpserver requirements]# echo $?</span><br><span class="line">0</span><br><span class="line">(py3) [root@jumpserver requirements]# pip install --no-index --find-links=/root/pip-packs/ -r requirements.txt     #-r的意思和刚才的$(cat rpm_requirements.txt)相同</span><br><span class="line">。。。。。。</span><br><span class="line">完毕！</span><br><span class="line">(py3) [root@jumpserver requirements]# echo $?</span><br><span class="line">0</span><br><span class="line">#在有网络的环境下安装：（修改yum源文件）</span><br><span class="line">默认下载pip指的是国外的源，下载特别慢，但是可以给pip指定国内的源来提升下载速度</span><br><span class="line">(py3) [root@jumpserver ~]# mkdir /root/.pip</span><br><span class="line">(py3) [root@jumpserver ~]# vim /root/.pip/pip.conf</span><br><span class="line">[global]</span><br><span class="line">index-url = https://pypi.tuna.tsinghua.edu.cn/simple  #这个是清华源</span><br><span class="line">[install]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br><span class="line">(py3) [root@jumpserver ~]# pip install --upgrade pip  #安装之前先更新pip版本，不然会报错</span><br><span class="line">(py3) [root@jumpserver ~]# pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******(6)安装redis，如果有预先部署好的redis可以不用安装，可以使用yum或者源码包来安装</span><br><span class="line">(py3) [root@jumpserver requirements]# yum -y install redis</span><br><span class="line">。。。。。。</span><br><span class="line">完毕！</span><br><span class="line">(py3) [root@jumpserver requirements]# systemctl start redis</span><br><span class="line">(py3) [root@jumpserver requirements]# systemctl enable redis</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/redis.service to /usr/lib/systemd/system/redis.service.</span><br><span class="line">(py3) [root@jumpserver requirements]# echo $?</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******（7）安装mysql，如果有预先部署好的mysql可以不用安装，可以使用yum安装mariadb或者源码安装mysql</span><br><span class="line">(py3) [root@jumpserver requirements]# yum -y install mariadb mariadb-devel mariadb-server</span><br><span class="line">。。。。。。</span><br><span class="line">完毕！</span><br><span class="line">(py3) [root@jumpserver requirements]# systemctl start mariadb</span><br><span class="line">(py3) [root@jumpserver requirements]# systemctl enable mariadb</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to /usr/lib/systemd/system/mariadb.service.</span><br><span class="line">(py3) [root@jumpserver requirements]# echo $?</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******（8）创建jumpserver数据库并且授权用户</span><br><span class="line">(py3) [root@jumpserver requirements]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.64-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create database jumpserver default charset &#x27;utf8&#x27;; #创建jumpserver库默认字体为utf8</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant all on jumpserver.* to &#x27;jumpserver&#x27;@&#x27;127.0.0.1&#x27; identified by &#x27;jumpserver&#x27;; #授权用户</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;  #更新权限</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; exit</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******（9）生成密钥，生成的两串随机数待会会用到</span><br><span class="line">(py3) [root@jumpserver requirements]# cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 49;echo #/dev/urandom是一个数据流，也就是随机数，默认里面是乱码，所以需要筛选，tr -dc A-Za-z0-9就是筛选字母大小写和数字的，head -c 49;echo也就是输出49个随机数</span><br><span class="line">Njkc2G6ZTbkmv6SKchQIHnR0ubk29yWyhG0annnef6IHi3xYE</span><br><span class="line">(py3) [root@jumpserver requirements]# cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 16 ; echo #和上面同理</span><br><span class="line">TDYY6C1tY24iZv6j</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******（10）修改jumpserver配置文件，配置文件是python格式的，不能使用tab要使用空格隔开</span><br><span class="line">(py3) [root@jumpserver requirements]# cd /opt/jumpserver/</span><br><span class="line">(py3) [root@jumpserver jumpserver]# cp config_example.yml config.yml</span><br><span class="line">(py3) [root@jumpserver jumpserver]# vim config.yml </span><br><span class="line">。。。。。。</span><br><span class="line"> 3 # $ cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 49;echo</span><br><span class="line"> 4 SECRET_KEY: Njkc2G6ZTbkmv6SKchQIHnR0ubk29yWyhG0annnef6IHi3xYE #中间都有空格</span><br><span class="line"> 5 </span><br><span class="line"> 6 # SECURITY WARNING: keep the bootstrap token used in production secret!</span><br><span class="line"> 7 # 预共享Token coco和guacamole用来注册服务账号，不在使用原来的注册接受机制</span><br><span class="line"> 8 BOOTSTRAP_TOKEN: pehtn3wIVSIuSK1v</span><br><span class="line"> 9 </span><br><span class="line">。。。。。。</span><br><span class="line"> 35 DB_ENGINE: mysql</span><br><span class="line"> 36 DB_HOST: 127.0.0.1</span><br><span class="line"> 37 DB_PORT: 3306</span><br><span class="line"> 38 DB_USER: jumpserver</span><br><span class="line"> 39 DB_PASSWORD: jumpserver  #注意密码、用户、数据库名称要和刚才数据库中的操作相同</span><br><span class="line"> 40 DB_NAME: jumpserver</span><br><span class="line"> 41 </span><br><span class="line">。。。。。。 #下面还可以修改redis配置，这里直接使用默认配置了</span><br><span class="line"> 49 # Redis配置</span><br><span class="line"> 50 REDIS_HOST: 127.0.0.1</span><br><span class="line"> 51 REDIS_PORT: 6379</span><br><span class="line"> 52 # REDIS_PASSWORD: </span><br><span class="line">#保存退出</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******（11）生成数据表结构和初始化数据</span><br><span class="line">(py3) [root@jumpserver jumpserver]# cd /opt/jumpserver/utils/</span><br><span class="line">(py3) [root@jumpserver utils]# sh make_migrations.sh </span><br><span class="line">(py3) [root@jumpserver utils]# echo $? </span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">******（12）运行jumpserver并且配置系统启动脚本</span><br><span class="line">(py3) [root@jumpserver utils]# cd /opt/jumpserver/</span><br><span class="line">(py3) [root@jumpserver jumpserver]# ./jms start all  #可以加-d放到后台运行，但是需要确保已经载入python3的虚拟环境CTRL+C退出，直接编写启动脚本就可以，jumpserver默认监听端口为8080</span><br><span class="line">(py3) [root@jumpserver jumpserver]# vim /usr/lib/systemd/system/jms.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=jms</span><br><span class="line">After=network.target mariadb.service redis.service docker.service</span><br><span class="line">Wants=mariadb.service redis.service docker.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">Environment=&quot;PATH=/opt/py3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin&quot;</span><br><span class="line">ExecStart=/opt/jumpserver/jms start all -d</span><br><span class="line">ExecRestart=/opt/jumpserver/jms restart all -d</span><br><span class="line">ExecStop=/opt/jumpserver/jms stop</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">(py3) [root@jumpserver jumpserver]# systemctl daemon-reload</span><br><span class="line">(py3) [root@jumpserver jumpserver]# systemctl start jms #开启jumpserver服务</span><br><span class="line">#启动有点慢</span><br><span class="line">(py3) [root@jumpserver jumpserver]# netstat -anpt | grep 8080</span><br><span class="line">tcp        0      0 0.0.0.0:8080            0.0.0.0:*               LISTEN      1389/python3.6    </span><br><span class="line">(py3) [root@jumpserver jumpserver]# systemctl enable jms</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/jms.service to /usr/lib/systemd/system/jms.service.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right: calc(50% - 1px);order: 1;border-right: 1px solid #fe2;padding-left: unset;max-width: calc(50% - 4px);"><a href="/2022/11/14/2022-11-11/">← Next 2022.11.14Hexo报错</a></div><div id="footer-link" style="left: 50%;order: 0;border-left: 1px solid #fe2;padding-right: unset;max-width: calc(50% - 5px);"><a href="/2022/11/11/2022.11.11/">2022.11.11问题总结 Prev →</a></div></div></div><details id="reward"><summary>打赏</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/wangjiewei123">人在塔在&amp;Blog</a></h1><div id="description"></div></div><div id="aside-block"><h1>INDEX</h1><div id="toc-div"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%A0%A1%E5%9E%92%E6%9C%BA"><span class="toc-number">1.</span> <span class="toc-text">什么是堡垒机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JumpServer%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">JumpServer概述</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JumpServer%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number"></span> <span class="toc-text">JumpServer实现的功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81Authentication"><span class="toc-number">0.1.</span> <span class="toc-text">身份验证Authentication</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86-Account"><span class="toc-number">0.2.</span> <span class="toc-text">账号管理 Account</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%E6%8E%A7%E5%88%B6Authorization"><span class="toc-number">0.3.</span> <span class="toc-text">授权控制Authorization</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1Audit"><span class="toc-number">0.4.</span> <span class="toc-text">安全审计Audit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2JumpServer%E5%A0%A1%E5%9E%92%E6%9C%BA"><span class="toc-number">0.5.</span> <span class="toc-text">部署JumpServer堡垒机</span></a></li></ol></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">鲁M</a></nobr><nobr><span class="text-title">©</span><span class="text-content">2022 to 2099</span></nobr><br><nobr>published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#Valine'
 , appId: 'LSe7mf1XYliLqgIrc3jlqXfT-gzGzoHsz'
 , appKey: 'Fu9giJfnidkCamaW89FUpidw' , placeholder: '此条评论委托企鹅物流发送'
});code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":300,"height":600},"mobile":{"show":true},"log":false});</script></body></html>